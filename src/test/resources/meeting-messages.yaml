openapi: "3.0.3"
info:
  title: Message definitions of example "meeting" API
  version: "${project.version}"
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
servers: []
paths: {}
components:
  schemas:
    MeetingMessage:
      description: Common parent schema of all async messages in the meeting API
      # common parent is not needed if only using the message type schemas from AsyncAPI
      allOf:
        - $ref: "../../main/openapi/cloudevents/v1/cloudevents-v1.yaml#/components/schemas/AsynchronousMessageBase"
      discriminator:
        propertyName: type
        mapping:
          "be.belgif.example.meeting.v3.meetings.create": CreateMeetingMessage
          "be.belgif.example.meeting.v3.meetings.create.reply": CreateMeetingReplyMessage
          "be.belgif.example.meeting.v3.meetings.create.problemReply": CreateMeetingProblemReplyMessage
          "be.belgif.example.meeting.v3.meetings.notify.invited": MeetingInvitedMessage
          "be.belgif.example.meeting.v3.meetings.notify.canceled": MeetingCanceledMessage
    Meeting:
      description: A meeting
      type: object
      properties:
        id:
          type: string
          description: Identifier of the meeting
        invitees:
          type: array
          items:
            description: "Identifier of a person"
            type: string
        room:
          type: string
        period:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
          required: [start, end]
        required: [invitees, period]
    CreateMeetingMessage:
      type: object
      allOf:
        - $ref: "#/components/schemas/MeetingMessage"
      properties:
        data:
          $ref: "#/components/schemas/Meeting"
      required: [data]
      example:
        {
          "specversion": "1.0",
          "id": "550e8400-e29b-41d4-a716-446655440000",
          "service": "be.belgif.example.meeting.v3",
          "type": "be.belgif.example.meeting.v3.meetings.create",
          "source": "urn:async-source:client:123",
          "subject": "132456",
          "data": {
            "invitees": ["123", "456"],
            "period": {
              "start": "2025-10-06T13:30:00+02:00",
              "end": "2025-10-06T14:30:00+02:00"
            }
          }
        }
    CreateMeetingReplyMessage:
      type: object
      allOf:
        - $ref: "#/components/schemas/MeetingMessage"
        # extends reply message, which adds relatedto(source) properties
        - $ref: "../../main/openapi/cloudevents/v1/cloudevents-v1.yaml#/components/schemas/AsynchronousReplyMessageBase"
      properties:
        data:
          type: object
          properties:
            id:
              description: Identifier of meeting that was created
              type: string
          required: [id]
      required: [ data ]
      example:
        {
          "specversion": "1.0",
          "id": "123ef800-e29b-41d4-a716-546655440001",
          "service": "be.belgif.example.meeting.v3",
          "source": "urn:async-source:be.belgif.example",
          "type": "be.belgif.example.meeting.v3.meetings.create.reply",
          "relatedto": "550e8400-e29b-41d4-a716-446655440000",
          "relatedtosource": "urn:async-source:client:123",
          "subject": "132456",
          "data": {
            "id": "132456"
          }
        }
    CreateMeetingProblemReplyMessage:
      type: object
      allOf:
        - $ref: "#/components/schemas/MeetingMessage"
        - $ref: "../../main/openapi/cloudevents/v1/cloudevents-v1.yaml#/components/schemas/AsynchronousProblemReplyMessage"
      example:
        {
          "specversion": "1.0",
          "id": "987654-1234-1235-4567489798",
          "service": "be.belgif.example.meeting.v3",
          "source": "urn:async-source:be.belgif.example",
          "type": "be.belgif.example.meeting.v3.meetings.create.problemReply",
          "datacontenttype": "application/problem+json",
          "relatedto": "550e8400-e29b-41d4-a716-446655440000",
          "relatedtosource": "urn:async-source:client:123",
          "data": {
            "type": "urn:problem-type:belgif:badRequest",
            "href": "https://www.belgif.be/specification/rest/api-guide/problems/badRequest.html",
            "title": "Bad Request",
            "detail":  "The input message is incorrect",
            "instance": "urn:uuid:987654-1234-1235-4567489798",
            "issues": [
              {
                "type": "urn:problem-type:belgif:input-validation:schemaViolation",
                "detail": "value 123 of invitees[0] is not of type string",
                "in": "body",
                "name": "invitees[0]",
                "value": 123
              }
            ]
          }
        }
    MeetingInvitedMessage:
      type: object
      allOf:
        - $ref: "#/components/schemas/MeetingMessage"
      properties:
        data:
          $ref: "#/components/schemas/Meeting"
      required: [ data ]
      example:
        {
          "specversion": "1.0",
          "id": "450e8400-e29b-41d4-a716-446655440007",
          "service": "be.belgif.example.meeting.v3",
          "type": "be.belgif.example.meeting.v3.meetings.notify.invited",
          "source": "urn:async-source:be.belgif.example",
          "subject": "132456",
          "data": {
            "id": "132456",
            "invitees": [ "123", "456" ],
            "period": {
              "start": "2025-10-06T13:30:00+02:00",
              "end": "2025-10-06T14:30:00+02:00"
            }
          }
        }
    MeetingCanceledMessage:
      type: object
      allOf:
        - $ref: "#/components/schemas/MeetingMessage"
      properties:
        data:
          type: object
          properties:
            id:
              description: Identifier of the meeting
              type: string
          required: [id]
      required: [ data ]
      example:
        {
          "specversion": "1.0",
          "id": "650e8400-e29b-41d4-a716-446655440006",
          "service": "be.belgif.example.meeting.v3",
          "type": "be.belgif.example.meeting.v3.meetings.notify.canceled",
          "source": "urn:async-source:be.belgif.example",
          "subject": "132456",
          "data": {
            "id": "132456",
          }
        }